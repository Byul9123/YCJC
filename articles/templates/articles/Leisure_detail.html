<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leisure Detail</title>
</head>
<body>
    <h1>레저 게시물 세부 정보</h1>
    <div>
        <h2>제목: {{ article.title }}</h2>
        <p>내용: {{ article.content }}</p>
        <p>작성자: {{ article.author }}</p>
        <p>날짜: {{ article.created_at }}</p>
        <!-- 추가적인 정보들을 필요에 따라 표시 -->
    </div>

    <!-- 댓글 섹션 -->
    <h2>댓글</h2>
    <ul>
        {% for comment in comments %}
            <li>
                <p>{{ comment.content }}</p>
                <p>작성자: {{ comment.user }}</p>
                <p>작성일자: {{ comment.created_at }}</p>
            </li>
        {% endfor %}
    </ul>

    <!-- 수정 및 삭제 버튼 -->
    <div>
        <a id="editBtn" href="#">수정</a>
        <form id="deleteForm" action="{% url 'articles:Leisure_detail' pk=article.id %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="_method" value="delete"> <!-- DELETE 메서드를 지정하기 위한 hidden input -->
            <button type="submit">삭제</button>
        </form>
    </div>

    <button onclick="goBack()">목록 보기</button>

    <script>
        function goBack() {
            window.history.back();
        }

        // 수정 버튼 클릭 시 Travel_detail 페이지로 이동하여 수정 모드로 설정
        document.getElementById("editBtn").addEventListener("click", function(event) {
            event.preventDefault(); // 기본 동작 방지
            // 현재 페이지 URL에 쿼리 매개변수 추가하여 이동
            var editUrl = "{{ request.path }}?mode=edit";
            window.location.href = editUrl;
        });

        function deleteArticle() {
            // AJAX를 사용하여 DELETE 요청 보내기
            fetch("{% url 'articles:Leisure_detail' pk=article.id %}", {
                method: "DELETE",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                }
            })
            .then(response => {
                if (response.ok) {
                    // 삭제 후 Travel_list 페이지로 리디렉션
                    window.location.href = "{% url 'articles:Leisure_list' %}";
                } else {
                    console.error('Failed to delete article.');
                }
            })
            .catch(error => console.error('Error:', error));
        }

        // 삭제 버튼에 클릭 이벤트 추가
        document.getElementById("deleteForm").addEventListener("submit", function(event) {
            event.preventDefault(); // 폼 제출 방지
            deleteArticle(); // 삭제 함수 호출
        });
    </script>
</body>
</html>
